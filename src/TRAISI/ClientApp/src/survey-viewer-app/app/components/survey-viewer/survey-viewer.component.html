<div id="question-viewer-wrapper" *ngIf="loadedComponents">
	<traisi-admin-toolbar *ngIf="isAdmin"></traisi-admin-toolbar>
	<ndc-dynamic
		*ngIf="headerComponent"
		[ndcDynamicComponent]="headerComponent"
		[ndcDynamicInputs]="headerInputs"
	></ndc-dynamic>

	<traisi-survey-header-display
		[pageTextColour]="pageTextColour"
		[useWhiteProgressLine]="useLightNavigationLines"
		#header
	></traisi-survey-header-display>

	<div class="survey-body-container">
		<div class="survey-body">
			<div
				class="survey-section-header"
				*ngIf="viewerState.isSectionActive"
				[style.background-color]="viewerTheme.sectionBackgroundColour"
				[style.color]="sectionTitleColour"
				[style.margin-right.px]="viewerState.activeSection.isHousehold ? 45 : 15"
			>
				{{ processedSectionLabel(viewerState.activeSection.label) }}
			</div>
			<div class="questions-container">
				<div class="question-section d-flex flex-column" *ngIf="viewerState.isLoaded">
					<ng-container *ngFor="let page of viewerState.viewContainers; let p = index">
						<ng-container *ngFor="let sectionRepeat of page.children; let r = index">
							<ng-container *ngFor="let sectionContainer of sectionRepeat.children; let i = index">
								<ng-container *ngFor="let groupContainer of sectionContainer.children; let j = index">
									<ng-container *ngFor="let repeatContainer of groupContainer.children; let k = index">
										<ng-container *ngFor="let repeat of repeatContainer.children; let q = index">
											<traisi-question-container class="flex-grow-1 d-flex flex-column"
												[surveyViewer]="ref"
												[respondent]="viewerState.activeRespondent"
												[question]="repeat.questionModel"
												[surveyViewQuestion]="repeat.questionModel"
												[surveyId]="surveyId"
												[repeatNumber]="q"
												[container]="repeat"
												[questionTypeMap]="questionTypeMap"
												[questionNameMap]="questionNameMap"
												*ngIf="viewerState.activeQuestionContainer === repeat"
												#questions
											></traisi-question-container>
										</ng-container>
									</ng-container>
								</ng-container>
							</ng-container>
						</ng-container>
					</ng-container>
				</div>
				<div
					class="group-member-names-container"
					[hidden]="
						!viewerState.isSectionActive ||
						(viewerState.isSectionActive && !viewerState.activeSection.isHousehold)
					"
				>
					<div class="group-member-names-section">
						<span
							*ngFor="let groupMember of viewerState.groupMembers; let m = index"
							class="group-member-name"
							(click)="showGroupMember(m)"
							[ngClass]="{
								'group-member-active': groupMember == viewerState.activeRespondent,
								'group-member-complete':
									getGroupMemberCompletionState(m) &&
									groupMember != viewerState.activeRespondent
							}"
						>
							{{ groupMember.name }}</span
						>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="question-viewer-nav" class="pl-md-3" [style.margin-right.px]="viewerState.activeSection && viewerState.activeSection.isHousehold ? 45 : 15">
		<div class="row justify-content-center">
			<div class="col-12 text-center">
				<button
					[ngClass]="navButtonClass"
					(click)="navigatePrevious()"
					[disabled]="!viewerState.isPreviousEnabled || viewerState.isNavProcessing"
					class="btn w-50 pl-4 pr-4 pt-md-3 pb-md-3 survey-nav-button"
					type="button"
				>
					<i class="fas text-danger fa-arrow-alt-circle-left mr-1"></i> {{ 'Viewer.Previous' | translate }}
				</button>
				<button
					*ngIf="!viewerState.isNavComplete"
					[ngClass]="navButtonClass"
					(click)="navigateNext()"
					[disabled]="!isNavigationNextEnabled || viewerState.isNavProcessing"
					class="btn w-50 pl-4 pr-4 pt-md-3 pb-md-3 survey-nav-button"
					type="button"
				>
					<div class="progress" *ngIf="isNextProcessing">
						<div
							class="progress-bar progress-bar-striped progress-bar-animated"
							role="progressbar"
							aria-valuenow="100"
							aria-valuemin="0"
							aria-valuemax="100"
							style="width: 100%"
						></div>
					</div>
					<div *ngIf="!isNextProcessing && !viewerState.isNavComplete">
						{{ 'Viewer.Next' | translate }} <i class="fas text-success fa-arrow-alt-circle-right ml-1"></i>
					</div>
				</button>
				<button
					*ngIf="viewerState.isNavComplete"
					[ngClass]="navButtonClass"
					(click)="navigateCompleteSurvey()"
					class="btn w-50 pl-4 pr-4 pt-md-3 pb-md-3 survey-nav-button"
					type="button"
				>
					<div>
						{{ 'Viewer.CompleteSurvey' | translate }}
						<i class="fas text-success fa-arrow-alt-circle-right ml-1"></i>
					</div>
				</button>
			</div>
		</div>
	</div>
	<ndc-dynamic
		*ngIf="footerComponent"
		[ndcDynamicComponent]="footerComponent"
		[ndcDynamicInputs]="footerInputs"
	></ndc-dynamic>
</div>

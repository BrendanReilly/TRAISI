<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>traisi documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">traisi documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>ConditionalOptionItem</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/admin-app/app/survey-builder/components/question-configuration/question-conditionals/source-conditional/conditional.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#code">code</a>
                                </li>
                                <li>
                                        <a href="#name">name</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="code"></a>
                                        <span class="name"><b>code</b><a href="#code"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>code:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name"><b>name</b><a href="#name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
	Component,
	OnInit,
	Input,
	ViewChild,
	AfterViewInit,
	EventEmitter,
	Output,
	ChangeDetectorRef
} from &#x27;@angular/core&#x27;;
import {
	TreeviewItem,
	DownlineTreeviewItem,
	TreeviewEventParser,
	OrderDownlineTreeviewEventParser,
	DropdownTreeviewComponent,
	TreeviewSelection,
	TreeviewI18nDefault,
	TreeviewConfig
} from &#x27;ngx-treeview&#x27;;
import { QuestionConditionalSourceGroup } from &#x27;../../../../models/question-conditional-source-group.model&#x27;;
import { QuestionConditional } from &#x27;../../../../models/question-conditional.model&#x27;;
import { QuestionOptionConditional } from &#x27;../../../../models/question-option-conditional.model&#x27;;
import { BsDaterangepickerConfig } from &#x27;ngx-bootstrap&#x27;;
import { QuestionOptionValue } from &#x27;../../../../models/question-option-value.model&#x27;;

interface ConditionalOptionItem {
	name: string;
	code: string;
}

@Component({
	selector: &#x27;app-conditional&#x27;,
	templateUrl: &#x27;./conditional.component.html&#x27;,
	styleUrls: [&#x27;./conditional.component.scss&#x27;],
	providers: [{ provide: TreeviewEventParser, useClass: OrderDownlineTreeviewEventParser }]
})
export class SourceConditionalComponent implements OnInit, AfterViewInit {
	public dropDownListItems: Array&lt;string&gt; &#x3D; [];

	public treedropdownConfig: TreeviewConfig &#x3D; {
		hasAllCheckBox: false,
		hasFilter: false,
		hasDivider: false,
		hasCollapseExpand: false,
		decoupleChildFromParent: false,
		maxHeight: 500
	};

	public treedropdownSingleConfig: TreeviewConfig &#x3D; {
		hasAllCheckBox: false,
		hasFilter: false,
		hasDivider: false,
		hasCollapseExpand: false,
		decoupleChildFromParent: false,
		maxHeight: 500
	};

	public bsConfig: Partial&lt;BsDaterangepickerConfig&gt; &#x3D; Object.assign(
		{},
		{
			containerClass: &#x27;theme-default&#x27;,
			dateInputFormat: &#x27;YYYY-MM-DD&#x27;
		}
	);

	public copiedOptionList: any[] &#x3D; [];
	public sourceQuestionConditionalsList: QuestionConditional[] &#x3D; [];
	public sourceQuestionOptionConditionalsList: QuestionOptionConditional[] &#x3D; [];

	private checkedWithParents: DownlineTreeviewItem[] &#x3D; [];

	public dateRange: Date[] &#x3D; [];

	@Input()
	public responseType: string;

	@Input()
	public questionType: string;

	@Input()
	public questionPartId: number;

	@Input()
	public sourceGroup: QuestionConditionalSourceGroup;

	@Input()
	public optionList: TreeviewItem[];

	@Input()
	public questionOptions: Map&lt;string, QuestionOptionValue[]&gt; &#x3D; new Map&lt;string, QuestionOptionValue[]&gt;();

	@Output()
	public setBoundsSelected: EventEmitter&lt;QuestionConditionalSourceGroup&gt; &#x3D; new EventEmitter&lt;
		QuestionConditionalSourceGroup
	&gt;();

	@ViewChild(&#x27;optionTargets&#x27;)
	public optionTargetsTreeDropdown: DropdownTreeviewComponent;

	public optionSelectValues: any[] &#x3D; [];
	constructor(private changeDetectRef: ChangeDetectorRef) { }

	public ngOnInit(): void {
		this.setConditionsForQuestionType();
		if (this.sourceGroup.condition &#x3D;&#x3D;&#x3D; &#x27;&#x27;) {
			this.sourceGroup.condition &#x3D; this.dropDownListItems[0];
		}
		if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;OptionList&#x27; || this.responseType &#x3D;&#x3D;&#x3D; &#x27;OptionSelect&#x27;) {
			console.log(&#x27;in ngOnInit of conditional&#x27;);
			this.optionList.forEach((element) &#x3D;&gt; {
				console.log(element);
				let valueSplit: string[] &#x3D; element.value.split(&#x27;~&#x27;); // [0] - &#x27;option&#x27;, [1] - option group name, [2] - option id
				console.log(this.questionOptions);
				let codeFromId &#x3D; this.questionOptions.get(valueSplit[1]).filter((o) &#x3D;&gt; o.id &#x3D;&#x3D;&#x3D; +valueSplit[2])[0].code;
				let valueCheck &#x3D; &#x60;&quot;name&quot;:&quot;${valueSplit[1]}&quot;,&quot;code&quot;:&quot;${codeFromId}&quot;&#x60;;
				let copiedItem &#x3D; new TreeviewItem({
					value: element.value,
					text: element.text,
					checked: this.sourceGroup.value.includes(valueCheck)
				});
				this.copiedOptionList.push(copiedItem);
			});
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;DateTime&#x27;) {
			this.dateRange &#x3D; JSON.parse(this.sourceGroup.value);
		}
	}

	public ngAfterViewInit(): void {
		this.optionTargetsTreeDropdown.i18n &#x3D; new TreeviewI18nDefault();
		this.optionTargetsTreeDropdown.i18n.getText &#x3D; (e) &#x3D;&gt; this.targetsDropdown(e);
		this.changeDetectRef.detectChanges();
	}

	public showBoundsModal(): void {
		this.setBoundsSelected.emit(this.sourceGroup);
	}

	private targetsDropdown(e: TreeviewSelection): string {
		if (e.checkedItems.length &gt; 0) {
			return this.getPrunedCheckedTargets()
				.map((i) &#x3D;&gt; this.getQuestionOptionLabel(i))
				.join(&#x27;, &#x27;); // &#x60;${e.checkedItems.length} targets&#x60;;
		} else {
			return &#x27;Select hide targets&#x27;;
		}
	}

	private getPrunedCheckedTargets(): TreeviewItem[] {
		let pruned: TreeviewItem[] &#x3D; [];

		this.checkedWithParents.forEach((item) &#x3D;&gt; {
			if (item.parent &amp;&amp; item.parent.item.checked &amp;&amp; !item.parent.item.value.startsWith(&#x27;part&#x27;)) {
				if (!pruned.includes(item.parent.item)) {
					pruned.push(item.parent.item);
				}
			} else {
				pruned.push(item.item);
			}
		});
		return pruned;
	}

	private getQuestionOptionLabel(item: TreeviewItem): string {
		let itemType &#x3D; this.getItemType(item.value);
		if (itemType &#x3D;&#x3D;&#x3D; &#x27;question&#x27;) {
			return &#x60;Q:${item.text}&#x60;;
		} else if (itemType &#x3D;&#x3D;&#x3D; &#x27;option&#x27;) {
			return &#x60;O:${item.text}&#x60;;
		}
	}

	private setConditionsForQuestionType(): void {

		if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;String&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;Contains&#x27;, &#x27;Does Not Contain&#x27;];
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;Boolean&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;Is Equal To&#x27;];
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;Integer&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;Is Equal To&#x27;, &#x27;Is Not Equal To&#x27;, &#x27;Greater Than&#x27;, &#x27;Less Than&#x27;];
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;Decimal&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;Is Equal To&#x27;, &#x27;Is Not Equal To&#x27;, &#x27;Greater Than&#x27;, &#x27;Less Than&#x27;];
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;Location&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;In Bounds&#x27;, &#x27;Out Of Bounds&#x27;];
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;Json&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;Contains&#x27;, &#x27;Does Not Contain&#x27;];
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;OptionSelect&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;Is Any Of&#x27;, &#x27;Is All Of&#x27;];
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;OptionList&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;Is Any Of&#x27;, &#x27;Is All Of&#x27;];
		} else if (this.responseType &#x3D;&#x3D;&#x3D; &#x27;DateTime&#x27;) {
			this.dropDownListItems &#x3D; [&#x27;In Range&#x27;, &#x27;Outside Range&#x27;];
		}
	}

	public conditionValueChanged(e: string): void {
		this.sourceGroup.condition &#x3D; this.dropDownListItems.filter((dd) &#x3D;&gt; dd &#x3D;&#x3D;&#x3D; e)[0];
		// update condition value in conditionals lists
		this.sourceQuestionConditionalsList.forEach((conditional) &#x3D;&gt; {
			conditional.condition &#x3D; this.sourceGroup.condition;
		});
		this.sourceQuestionOptionConditionalsList.forEach((conditional) &#x3D;&gt; {
			conditional.condition &#x3D; this.sourceGroup.condition;
		});
	}

	public updateConditionalsValues(): void {
		this.sourceQuestionConditionalsList.forEach((conditional) &#x3D;&gt; {
			conditional.value &#x3D; this.sourceGroup.value;
		});
		this.sourceQuestionOptionConditionalsList.forEach((conditional) &#x3D;&gt; {
			conditional.value &#x3D; this.sourceGroup.value;
		});
	}

	public onSelectedChangeTargets(downlineItems: DownlineTreeviewItem[]): void {
		this.checkedWithParents &#x3D; downlineItems;
		let priorSourceQuestionConditionals &#x3D; this.sourceQuestionConditionalsList;
		let priorSourceQuestionOptionConditionals &#x3D; this.sourceQuestionOptionConditionalsList;
		this.sourceQuestionConditionalsList &#x3D; [];
		this.sourceQuestionOptionConditionalsList &#x3D; [];

		downlineItems.forEach((selectedTarget) &#x3D;&gt; {
			// if option, add only if parent question is unchecked
			if ((&lt;string&gt;selectedTarget.item.value).startsWith(&#x27;option&#x27;)) {
				if (!selectedTarget.parent.item.checked) {
					let id &#x3D; +selectedTarget.item.value.split(&#x27;~&#x27;)[2];
					let existing: QuestionOptionConditional &#x3D; priorSourceQuestionOptionConditionals.filter(
						(o) &#x3D;&gt; o.targetOptionId &#x3D;&#x3D;&#x3D; id
					)[0];
					if (existing) {
						this.sourceQuestionOptionConditionalsList.push(existing);
					} else {
						let newOptionConditional: QuestionOptionConditional &#x3D; new QuestionOptionConditional(
							0,
							id,
							this.questionPartId,
							this.sourceGroup.condition,
							this.sourceGroup.value
						);
						this.sourceQuestionOptionConditionalsList.push(newOptionConditional);
					}
				} else {
					let idSplit &#x3D; selectedTarget.parent.item.value.split(&#x27;~&#x27;);
					let id &#x3D; +idSplit[2];
					let existingPrevious: QuestionConditional &#x3D; priorSourceQuestionConditionals.filter(
						(o) &#x3D;&gt; o.targetQuestionId &#x3D;&#x3D;&#x3D; id
					)[0];
					let existingAlready: QuestionConditional &#x3D; this.sourceQuestionConditionalsList.filter(
						(o) &#x3D;&gt; o.targetQuestionId &#x3D;&#x3D;&#x3D; id
					)[0];
					if (existingAlready &#x3D;&#x3D;&#x3D; undefined) {
						if (existingPrevious) {
							this.sourceQuestionConditionalsList.push(existingPrevious);
						} else {
							let newConditional: QuestionConditional &#x3D; new QuestionConditional(
								0,
								id,
								this.questionPartId,
								this.sourceGroup.condition,
								this.sourceGroup.value
							);
							this.sourceQuestionConditionalsList.push(newConditional);
						}
					}
				}
			} else if ((&lt;string&gt;selectedTarget.item.value).startsWith(&#x27;question&#x27;)) {
				// if question, always add, after searching for existing
				let idSplit &#x3D; selectedTarget.item.value.split(&#x27;~&#x27;);
				let id &#x3D; +idSplit[2];
				let existing: QuestionConditional &#x3D; priorSourceQuestionConditionals.filter(
					(o) &#x3D;&gt; o.targetQuestionId &#x3D;&#x3D;&#x3D; id
				)[0];
				if (existing) {
					this.sourceQuestionConditionalsList.push(existing);
				} else {
					let newConditional: QuestionConditional &#x3D; new QuestionConditional(
						0,
						id,
						this.questionPartId,
						this.sourceGroup.condition,
						this.sourceGroup.value
					);
					this.sourceQuestionConditionalsList.push(newConditional);
				}
			}
		});
	}

	public onSelectedChangeOptions(downlineItems: DownlineTreeviewItem[]): void {
		// split value into json structure and stringify
		let valueStructure: Object &#x3D; {};
		this.sourceGroup.value &#x3D; JSON.stringify(
			downlineItems.map((i) &#x3D;&gt; {
				let split: string[] &#x3D; i.item.value.split(&#x27;~&#x27;); // [0] - &#x27;option&#x27;, [1] - option group name, [2] - option id
				let codeFromId &#x3D; this.questionOptions.get(split[1]).filter((o) &#x3D;&gt; o.id &#x3D;&#x3D;&#x3D; +split[2])[0].code;
				let conditionalOptionSelect: ConditionalOptionItem &#x3D; {
					name: split[1],
					code: codeFromId
				};
				return conditionalOptionSelect;
			})
		);
		this.sourceQuestionConditionalsList.forEach((conditional) &#x3D;&gt; {
			conditional.value &#x3D; this.sourceGroup.value;
		});
		this.sourceQuestionOptionConditionalsList.forEach((conditional) &#x3D;&gt; {
			conditional.value &#x3D; this.sourceGroup.value;
		});
	}

	// property conversions based on type

	public getItemType(value: string): string {
		return value.split(&#x27;~&#x27;)[0];
	}

	get booleanValue(): boolean {
		return this.sourceGroup.value &#x3D;&#x3D;&#x3D; &#x27;true&#x27;;
	}
	set booleanValue(value: boolean) {
		if (value &#x3D;&#x3D;&#x3D; true) {
			this.sourceGroup.value &#x3D; &#x27;true&#x27;;
		} else {
			this.sourceGroup.value &#x3D; &#x27;false&#x27;;
		}
	}

	get numberValue(): number {
		return +this.sourceGroup.value;
	}
	set numberValue(value: number) {
		this.sourceGroup.value &#x3D; &#x60;${value}&#x60;;
	}

	get optionSelectValue(): any {
		return this.sourceGroup.value;
	}
	set optionSelectValue(value: any) {
		this.sourceGroup.value &#x3D; value;
	}

	public onDateChange(newRange: Date[]): void {
		this.sourceGroup.value &#x3D; JSON.stringify(newRange);
	}
}
</code></pre>
    </div>
</div>






                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'ConditionalOptionItem.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
